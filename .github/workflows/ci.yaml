---

name: 'CI'


on:
  # workflow_call:
  #   inputs:
  #     build-branch:         # tag / dev
  #       required: true
  #       type: string
  push:
    branches:
      # - '*'         # matches every branch that doesn't contain a '/'
      # - '*/*'       # matches every branch containing a single '/'
      - '**'        # matches every branch
    tags:
      - '*'
  # pull_request:
  # #   branches:
  # #     - '**'
  #   types:
  # #     - opened
  #     - synchronize
  # #     - closed
  # #     - reopened


# env:
#   DOCKER_BUILD_IMAGE: "ghcr.io/${{ github.repository }}-fred:${{ github.sha }}"


# permissions:
#   pull-requests: write
#   contents: read
#   actions: read
#   checks: write
#   packages: write
#   security-events: write
#   statuses: write



jobs:


  python:
    name: 'Python'
    uses: ./.github/workflows/python.yaml
    # with:
    #   DOCKER_BUILD_IMAGE_NAME: "${{ github.repository }}"
    #   DOCKER_PUBLISH_REGISTRY: "ghcr.io"
    #   DOCKER_PUBLISH_IMAGE_NAME: "nofusscomputing/image-publish"


  docker:
    name: 'Docker'
    needs:
      - python
    uses: ./.github/workflows/docker.yaml
    with:
      DOCKER_BUILD_IMAGE_NAME: "${{ github.repository }}"
      DOCKER_PUBLISH_REGISTRY: "ghcr.io"
      DOCKER_PUBLISH_IMAGE_NAME: "nofusscomputing/image-publish"


  release:
    name: 'Release'
    uses: ./.github/workflows/release.yaml
    # with:
    #   DOCKER_BUILD_IMAGE_NAME: "${{ github.repository }}"

  # didnt work
  # generate-release-notes:
  #   name: Auto Release Notes
  #   needs:
  #     - docker
  #     - release
  #   runs-on: ubuntu-latest
  #   steps:

  #     - name: Append GH Release Body
  #       if: ${{ github.ref_type == 'tag' }}
  #       id: release
  #       uses: softprops/action-gh-release@v2
  #       with:
  #         append_body: true
  #         generate_release_notes: true